{"version":3,"file":"main-BmcNW1lX.js","sources":["../../ar-animation.js","../../image-tracker.js","../../main.js"],"sourcesContent":["// ç§»é™¤Three.jsä¾èµ–ï¼Œåªä½¿ç”¨åŸç”ŸCanvas API\n// import * as THREE from 'three';\n\nexport class ARAnimation {\n    constructor() {\n        this.canvas = null;\n        this.isVisible = false;\n        this.isRunning = false;\n        this.targetPosition = { x: 0, y: 0 };\n        this.targetSize = { width: 100, height: 100 };\n        \n        // PNGé€å¸§åŠ¨ç”»ç›¸å…³ - ä¼˜åŒ–ç‰ˆæœ¬\n        this.frames = []; // å­˜å‚¨æ‰€æœ‰å¸§å›¾ç‰‡\n        this.currentFrame = 0; // å½“å‰å¸§ç´¢å¼•\n        this.frameCount = 0; // æ€»å¸§æ•°\n        this.fps = 0.8; // é™ä½å¸§ç‡åˆ°0.8fpsï¼Œæ”¾æ…¢10å€åˆ‡æ¢é€Ÿåº¦\n        this.lastFrameTime = 0; // ä¸Šä¸€å¸§æ—¶é—´\n        this.isLoaded = false; // æ˜¯å¦åŠ è½½å®Œæˆ\n        \n        // 2D CanvasåŠ¨ç”»ç›¸å…³\n        this.ctx = null;\n        this.animationId = null;\n        \n        // æ€§èƒ½ä¼˜åŒ–ï¼šé¢„è®¡ç®—å°ºå¯¸\n        this.cachedSizes = new Map();\n        \n        console.log('ARåŠ¨ç”»ç±»åˆå§‹åŒ–å®Œæˆ');\n    }\n\n    start(canvas, position, size) {\n        if (!canvas) return;\n        \n        console.log('å¯åŠ¨ARåŠ¨ç”»...');\n        \n        this.canvas = canvas;\n        this.ctx = canvas.getContext('2d');\n        this.targetPosition = position || { x: 0, y: 0 };\n        this.targetSize = size || { width: 100, height: 100 };\n        \n        if (!this.isRunning) {\n            this.isRunning = true;\n            this.isVisible = true;\n            this.lastFrameTime = performance.now();\n            this.animate();\n        }\n        \n        console.log('ARåŠ¨ç”»å·²å¯åŠ¨');\n    }\n\n    stop() {\n        console.log('åœæ­¢ARåŠ¨ç”»...');\n        \n        this.isRunning = false;\n        this.isVisible = false;\n        \n        if (this.animationId) {\n            cancelAnimationFrame(this.animationId);\n            this.animationId = null;\n        }\n        \n        // æ¸…é™¤canvas\n        if (this.ctx && this.canvas) {\n            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        }\n        \n        console.log('ARåŠ¨ç”»å·²åœæ­¢');\n    }\n\n    // ä¼˜åŒ–çš„é€å¸§åŠ¨ç”»å¾ªç¯\n    animate() {\n        if (!this.isRunning || !this.ctx || !this.canvas) return;\n        \n        const currentTime = performance.now();\n        const deltaTime = currentTime - this.lastFrameTime;\n        \n        // æ ¹æ®å¸§ç‡æ›´æ–°å¸§\n        if (deltaTime >= (1000 / this.fps)) {\n            this.currentFrame = (this.currentFrame + 1) % this.frameCount;\n            this.lastFrameTime = currentTime;\n        }\n        \n        // æ¸…é™¤ä¹‹å‰çš„ç»˜åˆ¶\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        \n        // ç»˜åˆ¶å½“å‰å¸§\n        this.drawCurrentFrame();\n        \n        // ç»§ç»­åŠ¨ç”»å¾ªç¯\n        this.animationId = requestAnimationFrame(() => this.animate());\n    }\n\n    // ä¼˜åŒ–çš„ç»˜åˆ¶å½“å‰å¸§\n    drawCurrentFrame() {\n        if (!this.isLoaded || this.frames.length === 0) {\n            console.log('åŠ¨ç”»æœªåŠ è½½å®Œæˆï¼Œè·³è¿‡ç»˜åˆ¶', {\n                isLoaded: this.isLoaded,\n                framesCount: this.frames.length,\n                currentFrame: this.currentFrame\n            });\n            \n            // åœ¨canvasä¸Šç»˜åˆ¶è°ƒè¯•ä¿¡æ¯\n            if (this.ctx && this.canvas) {\n                this.ctx.fillStyle = 'rgba(255, 0, 0, 0.8)';\n                this.ctx.fillRect(10, 10, 300, 60);\n                this.ctx.fillStyle = 'white';\n                this.ctx.font = '16px Arial';\n                this.ctx.fillText('åŠ¨ç”»æœªåŠ è½½', 20, 35);\n                this.ctx.fillText(`å·²åŠ è½½: ${this.frames.filter(f => f).length}/${this.frameCount}`, 20, 55);\n            }\n            return;\n        }\n        \n        const frame = this.frames[this.currentFrame];\n        if (!frame) {\n            console.log('å½“å‰å¸§ä¸å­˜åœ¨', {\n                currentFrame: this.currentFrame,\n                totalFrames: this.frameCount,\n                frames: this.frames.map(f => f ? 'loaded' : 'null')\n            });\n            \n            // åœ¨canvasä¸Šç»˜åˆ¶è°ƒè¯•ä¿¡æ¯\n            if (this.ctx && this.canvas) {\n                this.ctx.fillStyle = 'rgba(255, 165, 0, 0.8)';\n                this.ctx.fillRect(10, 10, 300, 60);\n                this.ctx.fillStyle = 'white';\n                this.ctx.font = '16px Arial';\n                this.ctx.fillText('å½“å‰å¸§ä¸å­˜åœ¨', 20, 35);\n                this.ctx.fillText(`å¸§${this.currentFrame} / æ€»${this.frameCount}`, 20, 55);\n            }\n            return;\n        }\n        \n        // ä½¿ç”¨ç¼“å­˜çš„å°ºå¯¸è®¡ç®—\n        const drawInfo = this.getCachedDrawInfo(frame);\n        \n        // ç»˜åˆ¶å½“å‰å¸§\n        this.ctx.drawImage(\n            frame, \n            drawInfo.x, \n            drawInfo.y, \n            drawInfo.width, \n            drawInfo.height\n        );\n        // ä¸å†ç»˜åˆ¶ä»»ä½•è°ƒè¯•è¾¹æ¡†\n    }\n\n    // æ–°å¢ï¼šåœ¨æŒ‡å®šçš„contextä¸Šç»˜åˆ¶å½“å‰å¸§ï¼ˆç”¨äºæ‹ç…§åŠŸèƒ½ï¼‰\n    drawCurrentFrameToContext(targetCtx, canvasWidth, canvasHeight) {\n        if (!this.isLoaded || this.frames.length === 0) {\n            console.log('åŠ¨ç”»æœªåŠ è½½å®Œæˆï¼Œè·³è¿‡ç»˜åˆ¶åˆ°ç›®æ ‡context');\n            return;\n        }\n        \n        const frame = this.frames[this.currentFrame];\n        if (!frame) {\n            console.log('å½“å‰å¸§ä¸å­˜åœ¨ï¼Œè·³è¿‡ç»˜åˆ¶åˆ°ç›®æ ‡context');\n            return;\n        }\n        \n        // ä½¿ç”¨ä¸æ˜¾ç¤ºæ—¶ç›¸åŒçš„é€»è¾‘ï¼šä»¥ä¸­å¿ƒç‚¹è®¡ç®—ä½ç½®\n        const centerX = 50 + Math.max(this.targetSize.width * 1.5, 180) / 2; // è·ç¦»å·¦è¾¹ç¼˜50px + åŠ¨ç”»å®½åº¦çš„ä¸€åŠ\n        const centerY = canvasHeight - 200 + Math.max(this.targetSize.height * 1.5, 180) / 2; // è·ç¦»åº•éƒ¨200px + åŠ¨ç”»é«˜åº¦çš„ä¸€åŠ\n        \n        // ä½¿ç”¨1.5å€æ”¾å¤§çš„å°ºå¯¸ï¼Œä¸æ˜¾ç¤ºå°ºå¯¸ä¿æŒä¸€è‡´\n        const size = {\n            width: Math.max(this.targetSize.width * 1.5, 180), // 1.5å€æ”¾å¤§\n            height: Math.max(this.targetSize.height * 1.5, 180)\n        };\n        \n        // è®¡ç®—å¸§çš„ç»˜åˆ¶ä½ç½®å’Œå¤§å°\n        const frameWidth = frame.width;\n        const frameHeight = frame.height;\n        const scale = Math.min(size.width / frameWidth, size.height / frameHeight);\n        const drawWidth = frameWidth * scale;\n        const drawHeight = frameHeight * scale;\n        \n        // è®¡ç®—å·¦ä¸Šè§’ä½ç½®ï¼ˆä»¥ä¸­å¿ƒç‚¹è®¡ç®—ï¼Œä¸æ˜¾ç¤ºæ—¶ä¿æŒä¸€è‡´ï¼‰\n        const drawX = centerX - drawWidth / 2;\n        const drawY = centerY - drawHeight / 2;\n        \n        // è¾¹ç•Œæ£€æŸ¥ï¼Œç¡®ä¿åŠ¨ç”»ä¸ä¼šè¶…å‡ºç›®æ ‡canvas\n        let finalX = Math.max(20, Math.min(drawX, canvasWidth - drawWidth - 20));\n        let finalY = Math.max(20, Math.min(drawY, canvasHeight - drawHeight - 20));\n        \n        // ç»˜åˆ¶å½“å‰å¸§åˆ°ç›®æ ‡context\n        targetCtx.drawImage(\n            frame, \n            finalX, \n            finalY, \n            drawWidth, \n            drawHeight\n        );\n        \n        console.log('åŠ¨ç”»å¸§å·²ç»˜åˆ¶åˆ°ç›®æ ‡context', {\n            frame: this.currentFrame,\n            position: { x: finalX, y: finalY, width: drawWidth, height: drawHeight },\n            targetCanvasSize: `${canvasWidth}x${canvasHeight}`\n        });\n    }\n\n    // ç¼“å­˜ç»˜åˆ¶ä¿¡æ¯ï¼Œé¿å…é‡å¤è®¡ç®—\n    getCachedDrawInfo(frame) {\n        const cacheKey = `${frame.width}-${frame.height}-${this.targetSize.width}-${this.targetSize.height}`;\n        \n        if (this.cachedSizes.has(cacheKey)) {\n            return this.cachedSizes.get(cacheKey);\n        }\n        \n        // è®¡ç®—ç»˜åˆ¶ä½ç½®å’Œå¤§å°\n        const centerX = this.targetPosition.x;\n        const centerY = this.targetPosition.y;\n        \n        // ä½¿ç”¨1.5å€æ”¾å¤§çš„å°ºå¯¸ï¼Œç¡®ä¿åŠ¨ç”»è¶³å¤Ÿå¤§ä¸”æ¸…æ™°\n        const minSize = 150; // æœ€å°å°ºå¯¸ä¹Ÿæ”¾å¤§1.5å€\n        const maxSize = Math.max(this.targetSize.width, this.targetSize.height);\n        const size = Math.max(minSize, maxSize * 1.5); // 1.5å€æ”¾å¤§\n        \n        // è®¡ç®—å¸§çš„ç»˜åˆ¶ä½ç½®å’Œå¤§å°\n        const frameWidth = frame.width;\n        const frameHeight = frame.height;\n        const scale = Math.min(size / frameWidth, size / frameHeight);\n        const drawWidth = frameWidth * scale;\n        const drawHeight = frameHeight * scale;\n        \n        // è®¡ç®—å·¦ä¸Šè§’ä½ç½®\n        const drawX = centerX - drawWidth / 2;\n        const drawY = centerY - drawHeight / 2;\n        \n        // è¾¹ç•Œæ£€æŸ¥ï¼Œç¡®ä¿åŠ¨ç”»ä¸ä¼šè¶…å‡ºå±å¹•\n        const viewportWidth = window.innerWidth;\n        const viewportHeight = window.innerHeight;\n        \n        let finalX = Math.max(10, Math.min(drawX, viewportWidth - drawWidth - 10));\n        let finalY = Math.max(10, Math.min(drawY, viewportHeight - drawHeight - 10));\n        \n        const drawInfo = { x: finalX, y: finalY, width: drawWidth, height: drawHeight };\n        \n        // ç¼“å­˜ç»“æœ\n        this.cachedSizes.set(cacheKey, drawInfo);\n        \n        return drawInfo;\n    }\n\n    // ä¼˜åŒ–çš„PNGé€å¸§åŠ¨ç”»åŠ è½½\n    loadFrames() {\n        return new Promise((resolve, reject) => {\n            // æ ¹æ®ç¯å¢ƒä½¿ç”¨ä¸åŒçš„è·¯å¾„\n            const basePath = import.meta.env.DEV ? './images/' : '/AR2/images/';\n            const framePaths = [\n                basePath + 'zm1.png',\n                basePath + 'zm2.png'\n            ];\n            \n            let loadedCount = 0;\n            let errorCount = 0;\n            const totalFrames = framePaths.length;\n            \n            console.log('å¼€å§‹åŠ è½½PNGåŠ¨ç”»å¸§...', framePaths);\n            \n            // è®¾ç½®æ€»ä½“è¶…æ—¶\n            const overallTimeout = setTimeout(() => {\n                if (loadedCount < totalFrames) {\n                    console.error('åŠ¨ç”»åŠ è½½è¶…æ—¶ï¼Œå·²åŠ è½½:', loadedCount, '/', totalFrames);\n                    reject(new Error('åŠ¨ç”»åŠ è½½è¶…æ—¶'));\n                }\n            }, 5000); // å¢åŠ è¶…æ—¶æ—¶é—´åˆ°5ç§’\n            \n            framePaths.forEach((path, index) => {\n                const img = new Image();\n                \n                img.onload = () => {\n                    loadedCount++;\n                    console.log(`âœ… å¸§${index + 1}åŠ è½½æˆåŠŸ:`, path, `(${img.width}x${img.height})`);\n                    this.frames[index] = img;\n                    \n                    if (loadedCount === totalFrames) {\n                        clearTimeout(overallTimeout);\n                        this.frameCount = totalFrames;\n                        this.isLoaded = true;\n                        console.log('ğŸ‰ æ‰€æœ‰åŠ¨ç”»å¸§åŠ è½½å®Œæˆ!', {\n                            totalFrames: this.frameCount,\n                            frames: this.frames.map(f => f ? `${f.width}x${f.height}` : 'null')\n                        });\n                        resolve();\n                    }\n                };\n                \n                img.onerror = (error) => {\n                    errorCount++;\n                    console.error(`âŒ å¸§${index + 1}åŠ è½½å¤±è´¥:`, path, error);\n                    this.frames[index] = null;\n                    \n                    if (errorCount === totalFrames) {\n                        clearTimeout(overallTimeout);\n                        console.error('æ‰€æœ‰åŠ¨ç”»å¸§åŠ è½½å¤±è´¥');\n                        reject(new Error('æ‰€æœ‰åŠ¨ç”»å¸§åŠ è½½å¤±è´¥'));\n                    }\n                };\n                \n                // æ·»åŠ è·¨åŸŸæ”¯æŒ\n                img.crossOrigin = 'anonymous';\n                img.src = path;\n                console.log(`ğŸ”„ å¼€å§‹åŠ è½½å¸§${index + 1}:`, path);\n            });\n        });\n    }\n\n    // å…¼å®¹æ—§ç‰ˆæœ¬çš„GIFåŠ è½½æ–¹æ³•\n    loadGif(gifPath) {\n        console.log('æ£€æµ‹åˆ°GIFè·¯å¾„ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°PNGé€å¸§åŠ¨ç”»æ¨¡å¼');\n        return this.loadFrames();\n    }\n\n    // å…¼å®¹æ—§ç‰ˆæœ¬çš„æ–¹æ³•\n    init() {\n        console.log('ARåŠ¨ç”»åˆå§‹åŒ–å®Œæˆ');\n    }\n\n    showAnimation(position, size) {\n        this.start(null, position, size);\n    }\n\n    hideAnimation() {\n        this.stop();\n    }\n\n    update() {\n        // è¿™ä¸ªæ–¹æ³•ä¿ç•™ç”¨äºå…¼å®¹æ€§\n    }\n\n    dispose() {\n        this.stop();\n        \n        // æ¸…ç†å¸§å›¾ç‰‡\n        this.frames = [];\n        this.isLoaded = false;\n        \n        // æ¸…ç†ç¼“å­˜\n        this.cachedSizes.clear();\n        \n        console.log('ARåŠ¨ç”»èµ„æºå·²æ¸…ç†');\n    }\n} ","export class ImageTracker {\n    constructor() {\n        this.lastDetection = null;\n        this.detectionTimeout = 500; // å¢åŠ åˆ°500msï¼Œå‡å°‘é‡å¤æ£€æµ‹\n        this.templates = [];\n        this.threshold = 0.15; // é™ä½åŒ¹é…é˜ˆå€¼ï¼Œæé«˜æ£€æµ‹çµæ•åº¦\n        this.debugMode = false;\n        this.lastDetectionTime = 0;\n        this.detectionInterval = 250; // å¢åŠ åˆ°250msï¼Œå¤§å¹…å‡å°‘CPUä½¿ç”¨\n        this.isInitialized = false;\n        \n        // æ€§èƒ½ä¼˜åŒ–ï¼šç¼“å­˜æ£€æµ‹ç»“æœ\n        this.detectionCache = new Map();\n        this.cacheTimeout = 1000; // ç¼“å­˜1ç§’\n        \n        // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œå‡å°‘å¯åŠ¨æ—¶é—´\n        setTimeout(() => {\n            this.isInitialized = true;\n            console.log('å›¾ç‰‡è¿½è¸ªå™¨å»¶è¿Ÿåˆå§‹åŒ–å®Œæˆ');\n        }, 200); // å‡å°‘å»¶è¿Ÿæ—¶é—´\n    }\n\n    // æ·»åŠ æ¨¡æ¿å›¾ç‰‡ - è¿›ä¸€æ­¥ä¼˜åŒ–ç‰ˆæœ¬\n    addTemplate(imageUrl, name = 'template') {\n        return new Promise((resolve, reject) => {\n            const img = new Image();\n            img.crossOrigin = 'anonymous';\n            \n            // è®¾ç½®åŠ è½½è¶…æ—¶\n            const timeout = setTimeout(() => {\n                reject(new Error('å›¾ç‰‡åŠ è½½è¶…æ—¶'));\n            }, 2000); // å‡å°‘è¶…æ—¶æ—¶é—´\n            \n            img.onload = () => {\n                clearTimeout(timeout);\n                \n                // ä¼˜åŒ–canvasåˆ›å»º\n                const canvas = document.createElement('canvas');\n                const ctx = canvas.getContext('2d');\n                \n                // è¿›ä¸€æ­¥é™åˆ¶å›¾ç‰‡å°ºå¯¸ä»¥æé«˜æ€§èƒ½\n                const maxSize = 150; // å‡å°‘æœ€å¤§å°ºå¯¸\n                const scale = Math.min(maxSize / img.width, maxSize / img.height, 1);\n                canvas.width = img.width * scale;\n                canvas.height = img.height * scale;\n                \n                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n                \n                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n                this.templates.push({\n                    name,\n                    imageData,\n                    width: canvas.width,\n                    height: canvas.height\n                });\n                \n                console.log(`æ¨¡æ¿å›¾ç‰‡ \"${name}\" æ·»åŠ æˆåŠŸï¼Œå°ºå¯¸: ${canvas.width}x${canvas.height}`);\n                resolve();\n            };\n            \n            img.onerror = (error) => {\n                clearTimeout(timeout);\n                console.error(`æ¨¡æ¿å›¾ç‰‡ \"${name}\" åŠ è½½å¤±è´¥:`, error);\n                reject(error);\n            };\n            \n            img.src = imageUrl;\n        });\n    }\n\n    // ä¼˜åŒ–çš„å›¾ç‰‡æ£€æµ‹\n    async detect(ctx, width, height) {\n        try {\n            // é™åˆ¶æ£€æµ‹é¢‘ç‡\n            const now = Date.now();\n            if (now - this.lastDetectionTime < this.detectionInterval) {\n                return this.lastDetection ? this.lastDetection.result : { detected: false };\n            }\n            this.lastDetectionTime = now;\n\n            // æ£€æŸ¥ç¼“å­˜\n            const cacheKey = `${width}x${height}`;\n            const cachedResult = this.detectionCache.get(cacheKey);\n            if (cachedResult && now - cachedResult.timestamp < this.cacheTimeout) {\n                return cachedResult.result;\n            }\n\n            // æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„æ£€æµ‹ç»“æœ\n            if (this.lastDetection && \n                now - this.lastDetection.timestamp < this.detectionTimeout) {\n                return this.lastDetection.result;\n            }\n\n            // è·å–å½“å‰å¸§çš„å›¾åƒæ•°æ®\n            const frameData = ctx.getImageData(0, 0, width, height);\n            \n            // å¯¹æ¯ä¸ªæ¨¡æ¿è¿›è¡ŒåŒ¹é…\n            for (const template of this.templates) {\n                const match = this.matchTemplateOptimized(frameData, template, width, height);\n                \n                if (match && match.confidence > this.threshold) {\n                    const result = {\n                        detected: true,\n                        type: 'image',\n                        name: template.name,\n                        position: match.position,\n                        size: match.size,\n                        confidence: match.confidence\n                    };\n                    \n                    // ç¼“å­˜ç»“æœ\n                    this.detectionCache.set(cacheKey, {\n                        timestamp: now,\n                        result: result\n                    });\n                    \n                    this.lastDetection = {\n                        timestamp: now,\n                        result: result\n                    };\n                    \n                    console.log(`âœ… æ£€æµ‹åˆ°å›¾ç‰‡ \"${template.name}\"ï¼ŒåŒ¹é…åº¦: ${match.confidence.toFixed(3)}`);\n                    return result;\n                }\n            }\n\n            // å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°å›¾ç‰‡ï¼Œæ¸…é™¤ä¸Šæ¬¡æ£€æµ‹ç»“æœ\n            if (this.lastDetection && \n                now - this.lastDetection.timestamp > this.detectionTimeout) {\n                this.lastDetection = null;\n            }\n\n            // ç¼“å­˜æœªæ£€æµ‹åˆ°ç»“æœ\n            const noDetectionResult = { detected: false };\n            this.detectionCache.set(cacheKey, {\n                timestamp: now,\n                result: noDetectionResult\n            });\n\n            return noDetectionResult;\n\n        } catch (error) {\n            console.error('å›¾ç‰‡æ£€æµ‹é”™è¯¯:', error);\n            return { detected: false };\n        }\n    }\n\n    // ä¼˜åŒ–çš„æ¨¡æ¿åŒ¹é…ç®—æ³•\n    matchTemplateOptimized(frameData, template, frameWidth, frameHeight) {\n        const templateWidth = template.width;\n        const templateHeight = template.height;\n        \n        // å¦‚æœæ¨¡æ¿å¤ªå¤§ï¼Œè·³è¿‡\n        if (templateWidth > frameWidth || templateHeight > frameHeight) {\n            return null;\n        }\n\n        let bestMatch = null;\n        let bestConfidence = 0;\n\n        // å¢åŠ æœç´¢æ­¥é•¿ä»¥æé«˜æ€§èƒ½\n        const step = Math.max(3, Math.floor(Math.min(templateWidth, templateHeight) / 20));\n        \n        // é™åˆ¶æœç´¢èŒƒå›´ï¼Œåªæœç´¢ä¸­å¿ƒåŒºåŸŸ\n        const searchMargin = Math.min(80, Math.floor(Math.min(frameWidth, frameHeight) * 0.08));\n        const startX = searchMargin;\n        const startY = searchMargin;\n        const endX = frameWidth - templateWidth - searchMargin;\n        const endY = frameHeight - templateHeight - searchMargin;\n        \n        // ä½¿ç”¨æ›´å°‘çš„é‡‡æ ·ç‚¹\n        const maxSamples = 100; // é™åˆ¶æœ€å¤§é‡‡æ ·æ•°\n        let sampleCount = 0;\n        \n        for (let y = startY; y <= endY && sampleCount < maxSamples; y += step) {\n            for (let x = startX; x <= endX && sampleCount < maxSamples; x += step) {\n                sampleCount++;\n                \n                const confidence = this.calculateSimilarityFast(\n                    frameData, template.imageData,\n                    x, y, frameWidth,\n                    0, 0, templateWidth,\n                    templateWidth, templateHeight\n                );\n\n                if (confidence > bestConfidence) {\n                    bestConfidence = confidence;\n                    bestMatch = {\n                        position: { x, y },\n                        size: { width: templateWidth, height: templateHeight },\n                        confidence\n                    };\n                    \n                    // å¦‚æœæ‰¾åˆ°å¾ˆå¥½çš„åŒ¹é…ï¼Œæå‰é€€å‡º\n                    if (confidence > 0.8) {\n                        return bestMatch;\n                    }\n                }\n            }\n        }\n\n        return bestMatch;\n    }\n\n    // å¿«é€Ÿç›¸ä¼¼åº¦è®¡ç®—\n    calculateSimilarityFast(frameData, templateData, frameX, frameY, frameWidth, \n                           templateX, templateY, templateWidth, width, height) {\n        let totalDiff = 0;\n        let totalPixels = 0;\n\n        // ä½¿ç”¨æ›´å°‘çš„é‡‡æ ·ç‚¹è¿›è¡Œè®¡ç®—\n        const sampleStep = Math.max(1, Math.floor(Math.min(width, height) / 10));\n        \n        for (let y = 0; y < height; y += sampleStep) {\n            for (let x = 0; x < width; x += sampleStep) {\n                const frameIndex = ((frameY + y) * frameWidth + (frameX + x)) * 4;\n                const templateIndex = ((templateY + y) * templateWidth + (templateX + x)) * 4;\n\n                // åªè®¡ç®—RGBå·®å¼‚ï¼Œå¿½ç•¥Alphaé€šé“\n                const rDiff = Math.abs(frameData.data[frameIndex] - templateData.data[templateIndex]);\n                const gDiff = Math.abs(frameData.data[frameIndex + 1] - templateData.data[templateIndex + 1]);\n                const bDiff = Math.abs(frameData.data[frameIndex + 2] - templateData.data[templateIndex + 2]);\n\n                totalDiff += (rDiff + gDiff + bDiff) / 3;\n                totalPixels++;\n            }\n        }\n\n        // è®¡ç®—ç›¸ä¼¼åº¦ï¼ˆ0-1ï¼Œ1è¡¨ç¤ºå®Œå…¨åŒ¹é…ï¼‰\n        if (totalPixels === 0) return 0;\n        const averageDiff = totalDiff / totalPixels;\n        return Math.max(0, 1 - averageDiff / 255);\n    }\n\n    // åŸå§‹æ¨¡æ¿åŒ¹é…ç®—æ³•ï¼ˆä¿ç•™ç”¨äºå…¼å®¹æ€§ï¼‰\n    matchTemplate(frameData, template, frameWidth, frameHeight) {\n        return this.matchTemplateOptimized(frameData, template, frameWidth, frameHeight);\n    }\n\n    // åŸå§‹ç›¸ä¼¼åº¦è®¡ç®—ï¼ˆä¿ç•™ç”¨äºå…¼å®¹æ€§ï¼‰\n    calculateSimilarity(frameData, templateData, frameX, frameY, frameWidth, \n                       templateX, templateY, templateWidth, width, height) {\n        return this.calculateSimilarityFast(frameData, templateData, frameX, frameY, frameWidth, \n                                          templateX, templateY, templateWidth, width, height);\n    }\n\n    // ç®€åŒ–çš„å›¾ç‰‡æ£€æµ‹ï¼ˆåŸºäºé¢œè‰²å’Œå½¢çŠ¶ç‰¹å¾ï¼‰\n    detectSimple(ctx, width, height) {\n        try {\n            const imageData = ctx.getImageData(0, 0, width, height);\n            \n            // å¯»æ‰¾é«˜å¯¹æ¯”åº¦åŒºåŸŸ\n            const regions = this.findHighContrastRegions(imageData, width, height);\n            \n            for (const region of regions) {\n                if (this.isImageLike(region, imageData, width, height)) {\n                    return {\n                        detected: true,\n                        type: 'simple',\n                        position: { x: region.x, y: region.y },\n                        size: { width: region.width, height: region.height },\n                        confidence: 0.5\n                    };\n                }\n            }\n            \n            return { detected: false };\n            \n        } catch (error) {\n            console.error('ç®€åŒ–æ£€æµ‹é”™è¯¯:', error);\n            return { detected: false };\n        }\n    }\n\n    // å¯»æ‰¾é«˜å¯¹æ¯”åº¦åŒºåŸŸ\n    findHighContrastRegions(imageData, width, height) {\n        const regions = [];\n        const regionSize = 50;\n        const step = 25;\n        \n        for (let y = 0; y < height - regionSize; y += step) {\n            for (let x = 0; x < width - regionSize; x += step) {\n                const contrast = this.calculateRegionContrast(imageData, x, y, regionSize, width);\n                \n                if (contrast > 30) { // é™ä½å¯¹æ¯”åº¦é˜ˆå€¼\n                    regions.push({\n                        x, y, width: regionSize, height: regionSize, contrast\n                    });\n                }\n            }\n        }\n        \n        // æŒ‰å¯¹æ¯”åº¦æ’åºï¼Œè¿”å›å‰å‡ ä¸ª\n        return regions.sort((a, b) => b.contrast - a.contrast).slice(0, 3);\n    }\n\n    // è®¡ç®—åŒºåŸŸå¯¹æ¯”åº¦\n    calculateRegionContrast(imageData, x, y, size, width) {\n        let minBrightness = 255;\n        let maxBrightness = 0;\n        \n        for (let dy = 0; dy < size; dy++) {\n            for (let dx = 0; dx < size; dx++) {\n                const index = ((y + dy) * width + (x + dx)) * 4;\n                const brightness = (imageData.data[index] + imageData.data[index + 1] + imageData.data[index + 2]) / 3;\n                \n                minBrightness = Math.min(minBrightness, brightness);\n                maxBrightness = Math.max(maxBrightness, brightness);\n            }\n        }\n        \n        return maxBrightness - minBrightness;\n    }\n\n    // æ£€æŸ¥åŒºåŸŸæ˜¯å¦åƒå›¾ç‰‡\n    isImageLike(region, imageData, width, height) {\n        // ç®€å•çš„å›¾ç‰‡ç‰¹å¾æ£€æŸ¥\n        const edgeDensity = this.calculateEdgeDensity(imageData, region.x, region.y, region.width, region.height, width);\n        return edgeDensity > 0.1; // è¾¹ç¼˜å¯†åº¦é˜ˆå€¼\n    }\n\n    // è®¡ç®—è¾¹ç¼˜å¯†åº¦\n    calculateEdgeDensity(imageData, x, y, w, h, width) {\n        let edgeCount = 0;\n        let totalPixels = 0;\n        \n        for (let dy = 1; dy < h - 1; dy++) {\n            for (let dx = 1; dx < w - 1; dx++) {\n                const index = ((y + dy) * width + (x + dx)) * 4;\n                const center = (imageData.data[index] + imageData.data[index + 1] + imageData.data[index + 2]) / 3;\n                \n                // æ£€æŸ¥å‘¨å›´åƒç´ \n                const left = ((y + dy) * width + (x + dx - 1)) * 4;\n                const leftBrightness = (imageData.data[left] + imageData.data[left + 1] + imageData.data[left + 2]) / 3;\n                \n                if (Math.abs(center - leftBrightness) > 20) {\n                    edgeCount++;\n                }\n                \n                totalPixels++;\n            }\n        }\n        \n        return totalPixels > 0 ? edgeCount / totalPixels : 0;\n    }\n\n    // æ¸…ç†èµ„æº\n    dispose() {\n        this.templates = [];\n        this.detectionCache.clear();\n        this.lastDetection = null;\n        console.log('å›¾ç‰‡è¿½è¸ªå™¨èµ„æºå·²æ¸…ç†');\n    }\n} ","import { ARAnimation } from './ar-animation.js';\nimport { ImageTracker } from './image-tracker.js';\n\nconsole.log('ARåº”ç”¨å¼€å§‹åŠ è½½...');\n\n// å¿«é€Ÿå¯åŠ¨æ¨¡å¼é…ç½®\nconst FAST_START_CONFIG = {\n    // å¿«é€Ÿå¯åŠ¨ï¼šç«‹å³æ˜¾ç¤ºç•Œé¢ï¼Œåå°åŠ è½½èµ„æº\n    enableFastStart: true,\n    // èµ„æºåŠ è½½è¶…æ—¶æ—¶é—´\n    resourceTimeout: 2000,\n    // æ£€æµ‹é—´éš”ï¼ˆæ¯«ç§’ï¼‰\n    detectionInterval: 200,\n    // ç®€åŒ–æ£€æµ‹æ¨¡å¼\n    simpleDetection: true,\n    // å»¶è¿Ÿåˆå§‹åŒ–è¿½è¸ªå™¨\n    delayTrackerInit: 500\n};\n\n// æ£€æŸ¥åŸºæœ¬åŠŸèƒ½\nfunction checkBasicFeatures() {\n    console.log('æ£€æŸ¥åŸºæœ¬åŠŸèƒ½...');\n    \n    // æ£€æŸ¥DOMæ˜¯å¦åŠ è½½å®Œæˆ\n    if (document.readyState === 'loading') {\n        console.log('DOMè¿˜åœ¨åŠ è½½ä¸­...');\n        return false;\n    }\n    \n    // æ£€æŸ¥å¿…è¦çš„å…ƒç´ æ˜¯å¦å­˜åœ¨\n    const startARBtn = document.getElementById('startAR');\n    const startScreen = document.getElementById('startScreen');\n    const arScreen = document.getElementById('arScreen');\n    const loadingScreen = document.getElementById('loadingScreen');\n    \n    console.log('UIå…ƒç´ æ£€æŸ¥:', {\n        startARBtn: !!startARBtn,\n        startScreen: !!startScreen,\n        arScreen: !!arScreen,\n        loadingScreen: !!loadingScreen\n    });\n    \n    if (!startARBtn || !startScreen || !arScreen || !loadingScreen) {\n        console.error('å¿…è¦çš„UIå…ƒç´ æœªæ‰¾åˆ°ï¼');\n        return false;\n    }\n    \n    return true;\n}\n\n// ä¼˜åŒ–çš„ARåº”ç”¨ç±»\nclass OptimizedARApp {\n    constructor() {\n        console.log('åˆå§‹åŒ–OptimizedARApp...');\n        this.isInitialized = false;\n        this.isTracking = false;\n        this.animation = null;\n        this.imageTracker = null;\n        this.detectionCanvas = null;\n        this.detectionCtx = null;\n        this.resourcesLoaded = false;\n        this.init();\n    }\n\n    init() {\n        console.log('å¼€å§‹å¿«é€Ÿåˆå§‹åŒ–...');\n        \n        if (!checkBasicFeatures()) {\n            console.error('åŸºæœ¬åŠŸèƒ½æ£€æŸ¥å¤±è´¥');\n            this.hideLoading();\n            this.showError('åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼šåŸºæœ¬åŠŸèƒ½æ£€æŸ¥å¤±è´¥');\n            return;\n        }\n        \n        try {\n            this.initUI();\n            this.initEventListeners();\n            \n            // å¿«é€Ÿå¯åŠ¨ï¼šç«‹å³æ˜¾ç¤ºç•Œé¢\n            if (FAST_START_CONFIG.enableFastStart) {\n                this.isInitialized = true;\n                this.hideLoading();\n                this.showStartScreen(); // æ˜ç¡®æ˜¾ç¤ºå¯åŠ¨ç•Œé¢\n                console.log('å¿«é€Ÿå¯åŠ¨å®Œæˆï¼Œç•Œé¢å·²æ˜¾ç¤º');\n                \n                // åå°å¼‚æ­¥åŠ è½½èµ„æº\n                this.loadResourcesInBackground();\n            } else {\n                // ä¼ ç»Ÿæ¨¡å¼ï¼šç­‰å¾…èµ„æºåŠ è½½å®Œæˆ\n                this.initTrackersAsync();\n            }\n            \n        } catch (error) {\n            console.error('åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‡ºé”™:', error);\n            this.hideLoading();\n            this.showError('åº”ç”¨åˆå§‹åŒ–å¤±è´¥: ' + error.message);\n        }\n    }\n\n    initUI() {\n        console.log('åˆå§‹åŒ–UIå…ƒç´ ...');\n        this.startScreen = document.getElementById('startScreen');\n        this.arScreen = document.getElementById('arScreen');\n        this.loadingScreen = document.getElementById('loadingScreen');\n        this.startARBtn = document.getElementById('startAR');\n        this.backBtn = document.getElementById('backBtn');\n        this.captureBtn = document.getElementById('captureBtn');\n        this.status = document.getElementById('status');\n        this.video = document.getElementById('video');\n        this.canvas = document.getElementById('canvas');\n        \n        if (this.canvas) {\n            this.ctx = this.canvas.getContext('2d');\n        }\n        \n        // åˆ›å»ºæ£€æµ‹ç”¨çš„canvas\n        this.detectionCanvas = document.createElement('canvas');\n        this.detectionCtx = this.detectionCanvas.getContext('2d');\n        \n        console.log('UIå…ƒç´ åˆå§‹åŒ–å®Œæˆ');\n    }\n\n    async loadResourcesInBackground() {\n        console.log('åå°åŠ è½½èµ„æº...');\n        \n        try {\n            // å»¶è¿Ÿåˆå§‹åŒ–è¿½è¸ªå™¨ï¼Œå‡å°‘å¯åŠ¨æ—¶é—´\n            setTimeout(async () => {\n                await this.initTrackersAsync();\n            }, FAST_START_CONFIG.delayTrackerInit);\n            \n        } catch (error) {\n            console.error('åå°èµ„æºåŠ è½½å¤±è´¥:', error);\n        }\n    }\n\n    async initTrackersAsync() {\n        try {\n            console.log('å¼€å§‹å¼‚æ­¥åˆå§‹åŒ–è¿½è¸ªå™¨...');\n            \n            // å¹¶è¡Œåˆå§‹åŒ–æ ¸å¿ƒç»„ä»¶\n            const [imageTracker, animation] = await Promise.allSettled([\n                this.createImageTracker(),\n                this.createAnimation()\n            ]);\n            \n            if (imageTracker.status === 'fulfilled') {\n                this.imageTracker = imageTracker.value;\n                console.log('å›¾ç‰‡è¿½è¸ªå™¨åˆå§‹åŒ–æˆåŠŸ');\n            }\n            \n            if (animation.status === 'fulfilled') {\n                this.animation = animation.value;\n                console.log('åŠ¨ç”»ç»„ä»¶åˆå§‹åŒ–æˆåŠŸ');\n            }\n            \n            this.resourcesLoaded = true;\n            console.log('ARç»„ä»¶åˆå§‹åŒ–å®Œæˆ');\n            \n        } catch (error) {\n            console.error('è¿½è¸ªå™¨åˆå§‹åŒ–å¤±è´¥:', error);\n        }\n    }\n\n    async createImageTracker() {\n        const tracker = new ImageTracker();\n        \n        // è®¾ç½®ç®€åŒ–çš„æ£€æµ‹æ¨¡å¼\n        if (FAST_START_CONFIG.simpleDetection) {\n            tracker.detectionInterval = FAST_START_CONFIG.detectionInterval;\n            tracker.threshold = 0.3; // é™ä½é˜ˆå€¼ï¼Œæé«˜æ£€æµ‹çµæ•åº¦\n        }\n        \n        // å°è¯•åŠ è½½markerï¼Œä½†ä¸é˜»å¡\n        try {\n            // æ ¹æ®ç¯å¢ƒä½¿ç”¨ä¸åŒçš„è·¯å¾„\n            const markerPath = import.meta.env.DEV ? './images/marker.png' : '/AR2/images/marker.png';\n            await tracker.addTemplate(markerPath, 'marker');\n            console.log('MarkeråŠ è½½æˆåŠŸ');\n        } catch (error) {\n            console.log('MarkeråŠ è½½å¤±è´¥:', error.message);\n            // ä¸æ·»åŠ å¤‡ç”¨æ¨¡æ¿ï¼Œé¿å…è¯¯æ£€æµ‹\n            throw error;\n        }\n        \n        return tracker;\n    }\n\n    async createAnimation() {\n        const animation = new ARAnimation();\n        \n        console.log('åˆ›å»ºåŠ¨ç”»ç»„ä»¶...');\n        \n        // å°è¯•åŠ è½½PNGåŠ¨ç”»ï¼Œä½†ä¸é˜»å¡\n        try {\n            await animation.loadFrames();\n            console.log('PNGåŠ¨ç”»åŠ è½½æˆåŠŸ');\n            console.log('åŠ¨ç”»çŠ¶æ€:', {\n                isLoaded: animation.isLoaded,\n                frameCount: animation.frameCount,\n                framesLength: animation.frames.length,\n                fps: animation.fps\n            });\n        } catch (error) {\n            console.log('PNGåŠ¨ç”»åŠ è½½å¤±è´¥:', error.message);\n            // å³ä½¿åŠ è½½å¤±è´¥ï¼Œä¹Ÿè¿”å›åŠ¨ç”»ç»„ä»¶ï¼Œé¿å…ä¸»åº”ç”¨å´©æºƒ\n        }\n        \n        return animation;\n    }\n\n    async addTestTemplate(tracker) {\n        try {\n            // åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•æ¨¡æ¿\n            const canvas = document.createElement('canvas');\n            const ctx = canvas.getContext('2d');\n            canvas.width = 80;\n            canvas.height = 80;\n            \n            // ç»˜åˆ¶ä¸€ä¸ªç®€å•çš„æµ‹è¯•å›¾æ¡ˆ\n            ctx.fillStyle = '#FFFFFF';\n            ctx.fillRect(0, 0, 80, 80);\n            ctx.strokeStyle = '#000000';\n            ctx.lineWidth = 2;\n            ctx.strokeRect(10, 10, 60, 60);\n            ctx.fillStyle = '#000000';\n            ctx.fillRect(25, 25, 30, 30);\n            \n            // å°†canvasè½¬æ¢ä¸ºblob URL\n            canvas.toBlob((blob) => {\n                const url = URL.createObjectURL(blob);\n                tracker.addTemplate(url, 'test-marker');\n                console.log('æµ‹è¯•æ¨¡æ¿æ·»åŠ æˆåŠŸ');\n            });\n            \n        } catch (error) {\n            console.error('æ·»åŠ æµ‹è¯•æ¨¡æ¿å¤±è´¥:', error);\n        }\n    }\n\n    initEventListeners() {\n        console.log('åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨...');\n        \n        if (this.startARBtn) {\n            this.startARBtn.addEventListener('click', () => this.startAR());\n        }\n        \n        if (this.backBtn) {\n            this.backBtn.addEventListener('click', () => this.stopAR());\n        }\n        \n        if (this.captureBtn) {\n            this.captureBtn.addEventListener('click', () => this.capturePhoto());\n        }\n        \n        console.log('äº‹ä»¶ç›‘å¬å™¨åˆå§‹åŒ–å®Œæˆ');\n    }\n\n    async startAR() {\n        console.log('å¼€å§‹ARä½“éªŒ...');\n        console.log('å½“å‰çŠ¶æ€:', {\n            isInitialized: this.isInitialized,\n            resourcesLoaded: this.resourcesLoaded,\n            hasImageTracker: !!this.imageTracker,\n            hasAnimation: !!this.animation\n        });\n        \n        // æ”¾å®½åˆå§‹åŒ–æ£€æŸ¥ï¼Œå…è®¸åœ¨èµ„æºæœªå®Œå…¨åŠ è½½æ—¶å¯åŠ¨\n        if (!this.isInitialized) {\n            console.log('åº”ç”¨æœªå®Œå…¨åˆå§‹åŒ–ï¼Œå°è¯•ç»§ç»­å¯åŠ¨...');\n            // ä¸é˜»æ­¢å¯åŠ¨ï¼Œè€Œæ˜¯ç»§ç»­å°è¯•\n        }\n        \n        try {\n            this.showARScreen();\n            \n            // ç¡®ä¿åŠ¨ç”»è¢«éšè—\n            this.hideAnimation();\n            \n            const cameraStarted = await this.requestCamera();\n            if (!cameraStarted) {\n                this.showError('æ— æ³•å¯åŠ¨æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™è®¾ç½®');\n                return;\n            }\n            \n            await this.waitForVideoLoad();\n            \n            // å¦‚æœè¿½è¸ªå™¨è¿˜æ²¡å‡†å¤‡å¥½ï¼Œç­‰å¾…ä¸€ä¸‹\n            if (!this.imageTracker) {\n                await this.waitForTracker();\n            }\n            \n            this.startTracking();\n            \n        } catch (error) {\n            console.error('å¯åŠ¨ARå¤±è´¥:', error);\n            this.showError('å¯åŠ¨ARå¤±è´¥: ' + error.message);\n        }\n    }\n\n    // ç­‰å¾…è¿½è¸ªå™¨å‡†å¤‡å°±ç»ª\n    async waitForTracker() {\n        return new Promise((resolve) => {\n            const checkTracker = () => {\n                if (this.imageTracker) {\n                    resolve();\n                } else {\n                    setTimeout(checkTracker, 100);\n                }\n            };\n            checkTracker();\n        });\n    }\n\n    startTracking() {\n        if (this.isTracking) return;\n        \n        this.isTracking = true;\n        this.trackFrame();\n        console.log('å¼€å§‹è¿½è¸ª');\n    }\n\n    stopTracking() {\n        this.isTracking = false;\n        \n        if (this.animation) {\n            this.animation.stop();\n        }\n        \n        console.log('åœæ­¢è¿½è¸ª');\n    }\n\n    trackFrame() {\n        if (!this.isTracking || !this.video || !this.canvas || !this.ctx) return;\n        \n        try {\n            // ç»˜åˆ¶è§†é¢‘å¸§åˆ°canvas\n            this.ctx.drawImage(this.video, 0, 0, this.canvas.width, this.canvas.height);\n            \n            // æ£€æµ‹marker\n            this.detectMarker();\n            \n            // ç»§ç»­ä¸‹ä¸€å¸§\n            requestAnimationFrame(() => this.trackFrame());\n            \n        } catch (error) {\n            console.error('è¿½è¸ªå¸§å¤„ç†é”™è¯¯:', error);\n            this.stopTracking();\n        }\n    }\n\n    async detectMarker() {\n        if (!this.imageTracker) {\n            console.log('å›¾ç‰‡è¿½è¸ªå™¨æœªå‡†å¤‡å¥½ï¼Œè·³è¿‡æ£€æµ‹');\n            return;\n        }\n        \n        if (!this.ctx) {\n            console.log('Canvasä¸Šä¸‹æ–‡æœªå‡†å¤‡å¥½ï¼Œè·³è¿‡æ£€æµ‹');\n            return;\n        }\n        \n        try {\n            const detectionResult = await this.imageTracker.detect(\n                this.ctx, \n                this.canvas.width, \n                this.canvas.height\n            );\n            \n            // æ›´å®½æ¾çš„æ£€æµ‹æ¡ä»¶\n            if (detectionResult && \n                detectionResult.detected && \n                detectionResult.confidence > 0.4 && // é™ä½ç½®ä¿¡åº¦è¦æ±‚\n                detectionResult.position && \n                detectionResult.size &&\n                detectionResult.size.width > 10 && // é™ä½æœ€å°å°ºå¯¸è¦æ±‚\n                detectionResult.size.height > 10) {\n                \n                console.log('æ£€æµ‹åˆ°marker:', {\n                    confidence: detectionResult.confidence,\n                    position: detectionResult.position,\n                    size: detectionResult.size\n                });\n                this.showAnimation(detectionResult);\n            } else {\n                // æ²¡æœ‰æ£€æµ‹åˆ°markerï¼Œéšè—åŠ¨ç”»\n                this.hideAnimation();\n            }\n            \n        } catch (error) {\n            console.error('æ£€æµ‹markeré”™è¯¯:', error);\n            // ä¸é˜»æ­¢ç»§ç»­æ£€æµ‹\n        }\n    }\n\n    showAnimation(detectionResult) {\n        if (!this.animation) {\n            console.log('åŠ¨ç”»ç»„ä»¶ä¸å­˜åœ¨ï¼Œè·³è¿‡æ˜¾ç¤º');\n            return;\n        }\n        \n        if (!this.canvas) {\n            console.log('Canvasä¸å­˜åœ¨ï¼Œè·³è¿‡æ˜¾ç¤º');\n            return;\n        }\n        \n        if (!detectionResult || !detectionResult.position || !detectionResult.size) {\n            console.log('æ£€æµ‹ç»“æœæ•°æ®ä¸å®Œæ•´ï¼Œè·³è¿‡æ˜¾ç¤º');\n            return;\n        }\n        \n        try {\n            // ä½ç½®è®¡ç®—ï¼šæ˜¾ç¤ºåœ¨å·¦ä¸‹è§’\n            const position = {\n                x: 50, // è·ç¦»å·¦è¾¹ç¼˜50px\n                y: this.canvas.height - 200 // è·ç¦»åº•éƒ¨200px\n            };\n            \n            // ä¼˜åŒ–å°ºå¯¸è®¡ç®—ï¼šå°†åŠ¨ç”»å°ºå¯¸æ”¾å¤§2å€ï¼ˆä»0.75å€å˜ä¸º1.5å€ï¼‰\n            const size = {\n                width: Math.max(detectionResult.size.width * 1.8, 180), // æ¯”markerå¤§1.8å€ï¼ˆ1.5å€ï¼‰ï¼Œæœ€å°180px\n                height: Math.max(detectionResult.size.height * 1.8, 180)\n            };\n            \n            console.log('å‡†å¤‡æ˜¾ç¤ºåŠ¨ç”»', {\n                position: position,\n                size: size,\n                animationLoaded: this.animation.isLoaded,\n                framesCount: this.animation.frames ? this.animation.frames.length : 0,\n                frameCount: this.animation.frameCount,\n                canvasSize: `${this.canvas.width}x${this.canvas.height}`\n            });\n            \n            this.animation.start(this.canvas, position, size);\n            \n        } catch (error) {\n            console.error('æ˜¾ç¤ºåŠ¨ç”»é”™è¯¯:', error);\n        }\n    }\n\n    hideAnimation() {\n        if (this.animation) {\n            this.animation.stop();\n        }\n    }\n\n    async requestCamera() {\n        try {\n            const stream = await navigator.mediaDevices.getUserMedia({\n                video: {\n                    width: { ideal: 640 },\n                    height: { ideal: 480 },\n                    facingMode: 'environment' // ä¼˜å…ˆä½¿ç”¨åç½®æ‘„åƒå¤´\n                }\n            });\n            \n            this.video.srcObject = stream;\n            this.video.play();\n            \n            console.log('æ‘„åƒå¤´å¯åŠ¨æˆåŠŸ');\n            return true;\n            \n        } catch (error) {\n            console.error('æ‘„åƒå¤´å¯åŠ¨å¤±è´¥:', error);\n            return false;\n        }\n    }\n\n    waitForVideoLoad() {\n        return new Promise((resolve, reject) => {\n            const timeout = setTimeout(() => {\n                reject(new Error('è§†é¢‘åŠ è½½è¶…æ—¶'));\n            }, 5000);\n            \n            this.video.onloadedmetadata = () => {\n                clearTimeout(timeout);\n                \n                // è®¾ç½®canvaså°ºå¯¸\n                this.canvas.width = this.video.videoWidth;\n                this.canvas.height = this.video.videoHeight;\n                \n                console.log('è§†é¢‘åŠ è½½å®Œæˆ');\n                resolve();\n            };\n            \n            this.video.onerror = (error) => {\n                clearTimeout(timeout);\n                reject(new Error('è§†é¢‘åŠ è½½å¤±è´¥'));\n            };\n        });\n    }\n\n    stopAR() {\n        console.log('åœæ­¢ARä½“éªŒ...');\n        this.stopTracking();\n        this.hideAnimation();\n        this.showStartScreen();\n        this.updateStatus('ARä½“éªŒå·²åœæ­¢ / AR Experience Stopped');\n    }\n\n    capturePhoto() {\n        if (!this.canvas || !this.video) return;\n        \n        try {\n            // åˆ›å»ºä¸´æ—¶canvasç”¨äºåˆæˆ\n            const tempCanvas = document.createElement('canvas');\n            const tempCtx = tempCanvas.getContext('2d');\n            \n            tempCanvas.width = this.canvas.width;\n            tempCanvas.height = this.canvas.height;\n            \n            // å…ˆç»˜åˆ¶æ‘„åƒå¤´ç”»é¢\n            tempCtx.drawImage(this.video, 0, 0, tempCanvas.width, tempCanvas.height);\n            \n            // å†å åŠ åŠ¨ç”»å¸§\n            if (this.animation && this.animation.isLoaded) {\n                this.animation.drawCurrentFrameToContext(tempCtx, tempCanvas.width, tempCanvas.height);\n            }\n            \n            // ä¿å­˜åˆæˆå›¾ç‰‡\n            const link = document.createElement('a');\n            link.download = `ar_photo_${Date.now()}.png`;\n            link.href = tempCanvas.toDataURL();\n            link.click();\n            \n            this.updateStatus('ç…§ç‰‡å·²ä¿å­˜ï¼ˆåŒ…å«å®Œæ•´èƒŒæ™¯å’ŒåŠ¨ç”»ï¼‰ / Photo saved (with background and animation)');\n        } catch (error) {\n            console.error('æ‹ç…§å¤±è´¥:', error);\n            this.updateStatus('æ‹ç…§å¤±è´¥ / Photo capture failed');\n        }\n    }\n\n    showLoading() {\n        if (this.loadingScreen) {\n            this.loadingScreen.style.display = 'flex';\n        }\n        if (this.startScreen) {\n            this.startScreen.style.display = 'none';\n        }\n        if (this.arScreen) {\n            this.arScreen.style.display = 'none';\n        }\n    }\n\n    hideLoading() {\n        if (this.loadingScreen) {\n            this.loadingScreen.style.display = 'none';\n        }\n    }\n\n    showStartScreen() {\n        if (this.startScreen) {\n            this.startScreen.style.display = 'flex';\n        }\n        if (this.arScreen) {\n            this.arScreen.style.display = 'none';\n        }\n        if (this.loadingScreen) {\n            this.loadingScreen.style.display = 'none';\n        }\n    }\n\n    showARScreen() {\n        if (this.arScreen) {\n            this.arScreen.style.display = 'flex';\n        }\n        if (this.startScreen) {\n            this.startScreen.style.display = 'none';\n        }\n        if (this.loadingScreen) {\n            this.loadingScreen.style.display = 'none';\n        }\n    }\n\n    updateStatus(message) {\n        if (this.status) {\n            this.status.textContent = message;\n        }\n        console.log('çŠ¶æ€æ›´æ–°:', message);\n    }\n\n    showError(message) {\n        console.error('é”™è¯¯:', message);\n        this.updateStatus('é”™è¯¯: ' + message + ' / Error: ' + message);\n        setTimeout(() => {\n            this.updateStatus('');\n        }, 3000);\n    }\n}\n\n// åˆå§‹åŒ–åº”ç”¨\nfunction initApp() {\n    console.log('å¼€å§‹åˆå§‹åŒ–ARåº”ç”¨...');\n    \n    // æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n        alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ç°ä»£æµè§ˆå™¨');\n        return;\n    }\n    \n    // åˆ›å»ºåº”ç”¨å®ä¾‹\n    window.arApp = new OptimizedARApp();\n}\n\n// ç­‰å¾…DOMåŠ è½½å®Œæˆååˆå§‹åŒ–\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initApp);\n} else {\n    initApp();\n} "],"names":["ARAnimation","canvas","position","size","currentTime","f","frame","drawInfo","targetCtx","canvasWidth","canvasHeight","centerX","centerY","frameWidth","frameHeight","scale","drawWidth","drawHeight","drawX","drawY","finalX","finalY","cacheKey","minSize","maxSize","viewportWidth","viewportHeight","resolve","reject","basePath","framePaths","loadedCount","errorCount","totalFrames","overallTimeout","path","index","img","error","gifPath","ImageTracker","imageUrl","name","timeout","ctx","imageData","width","height","now","cachedResult","frameData","template","match","result","noDetectionResult","templateWidth","templateHeight","bestMatch","bestConfidence","step","searchMargin","startX","startY","endX","endY","maxSamples","sampleCount","y","x","confidence","templateData","frameX","frameY","templateX","templateY","totalDiff","totalPixels","sampleStep","frameIndex","templateIndex","rDiff","gDiff","bDiff","averageDiff","regions","region","contrast","b","minBrightness","maxBrightness","dy","dx","brightness","w","h","edgeCount","center","left","leftBrightness","FAST_START_CONFIG","checkBasicFeatures","startARBtn","startScreen","arScreen","loadingScreen","OptimizedARApp","imageTracker","animation","tracker","blob","url","checkTracker","detectionResult","stream","tempCanvas","tempCtx","link","message","initApp"],"mappings":"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"}